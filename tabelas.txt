create database ecosrev;
use ecosrev;

CREATE TABLE usuarios (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nome VARCHAR(100) NOT NULL,
  email VARCHAR(100) NOT NULL UNIQUE,
  senha VARCHAR(255) NOT NULL,
  ativo BOOLEAN DEFAULT TRUE,
  tipo ENUM('Admin', 'Cliente') DEFAULT 'Cliente',
  pontos INT DEFAULT 200,
  resetPasswordToken BOOLEAN DEFAULT NULL,
  resetPasswordExpires DATETIME DEFAULT NULL
);

CREATE TABLE beneficios (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nome VARCHAR(200) NOT NULL,
  endereco VARCHAR(500) NOT NULL,
  pontos INT NOT NULL,
  data DATE NOT NULL,
  quantidade INT NOT NULL
);


CREATE TABLE beneficiosDoUsuario (
  id INT AUTO_INCREMENT PRIMARY KEY,
  idUsuario INT NOT NULL,
  idBeneficio INT NOT NULL,
  FOREIGN KEY (idUsuario) REFERENCES usuarios(id) ON DELETE CASCADE,
  FOREIGN KEY (idBeneficio) REFERENCES beneficios(id) ON DELETE CASCADE
);

CREATE TABLE histPontos (
  id VARCHAR(100) PRIMARY KEY,
  pontos NUMERIC,
  data DATETIME,
  idUsuario INT NOT NULL,
  FOREIGN KEY (idUsuario) REFERENCES usuarios(id) ON DELETE CASCADE
);

CREATE TABLE histTransacoes (
  id INT AUTO_INCREMENT PRIMARY KEY,
  descricao VARCHAR(100),
  pontos NUMERIC,
  data DATETIME,
  idUsuario INT NOT NULL,
  FOREIGN KEY (idUsuario) REFERENCES usuarios(id) ON DELETE CASCADE
);



select * from usuarios;
select * from beneficios;
select * from beneficiosDoUsuario;
select * from histPontos;
select * from histTransacoes;


SELECT 
    u.id AS idUsuario,
    u.nome AS nomeUsuario,
    b.id AS idBeneficio,
    b.nome AS nomeBeneficio,
    b.pontos AS pontosGastos,
    b.data AS dataBeneficio
FROM usuarios u
JOIN beneficiosDoUsuario bu ON u.id = bu.idUsuario
JOIN beneficios b ON b.id = bu.idBeneficio;


-- Usuários
INSERT INTO usuarios (nome, email, senha, tipo, pontos) VALUES
('João Silva', 'joao@email.com', '123456', 'Cliente', 200),
('Maria Souza', 'maria@email.com', 'abcdef', 'Cliente', 350),
('Ana Costa', 'ana@email.com', 'senhaSegura', 'Cliente', 150);

-- Benefícios
INSERT INTO beneficios (nome, endereco, pontos, data, quantidade) VALUES
('Ingresso Show', 'Rua das Flores, 123', 100, '2025-09-20', 50),
('Desconto Loja', 'Av. Central, 456', 50, '2025-09-21', 200),
('Vale-Transporte', 'Terminal Central', 200, '2025-09-22', 100);

-- Relacionando usuários com benefícios (beneficiosDoUsuario)
INSERT INTO beneficiosDoUsuario (idUsuario, idBeneficio) VALUES
(1, 1), -- João pegou Ingresso Show
(1, 2), -- João pegou Desconto Loja
(2, 3), -- Maria pegou Vale-Transporte
(3, 2); -- Ana pegou Desconto Loja


drop database ecosrev;